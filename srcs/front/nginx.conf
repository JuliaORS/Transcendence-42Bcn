server {
    listen 8443 ;
    server_name localhost;


    # Servir archivos estáticos desde la carpeta correspondiente
    location /static/ {
        alias /usr/share/nginx/html/static/;
    }

    # Redirigir todas las rutas de API al backend
    location /api/ {
        proxy_pass http://user_mgmt:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Redirigir TODAS las demás rutas al backend Django
    location / {
        proxy_pass http://user_mgmt:8000/;  # Redirige todas las solicitudes a Django
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Deshabilita el fallback al index.html local
        # Si quieres SPA: usa try_files $uri /index.html; en su lugar
    }
}

# server {
#     listen 8443;
#     server_name transcendence;

#     # SSL configuration (descomenta estas líneas si tienes certificados configurados)
#     # ssl_certificate /path/to/your/certificate.crt;
#     # ssl_certificate_key /path/to/your/private.key;

#     # Configuración de la raíz para archivos estáticos
#     root /usr/share/nginx/html;
#     #index index.html;

#     # Manejo de rutas a la raíz "/"
#     location / {
#         proxy_pass http://user_mgmt:8000/;  # Por defecto, redirige la raíz al backend
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }

#     # Rutas para API del servicio user_mgmt
#     location /api/user_mgmt/ {
#         proxy_pass http://user_mgmt:8000/;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }

#     # Rutas para API del servicio game
#     location /api/game/ {
#         proxy_pass http://game:8001/;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }

#     # WebSocket routing para game
#     location /ws/ {
#         proxy_pass http://game:8001/;
#         proxy_http_version 1.1;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection "upgrade";
#         proxy_set_header Host $host;
#     }

#     # Rutas adicionales para el juego
#     location /game {
#         proxy_pass http://localhost:8001/game;
#         proxy_http_version 1.1;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection "upgrade";
#         proxy_set_header Host $host;
#     }

#     # Archivos estáticos (si decides usar Nginx para servirlos)
#     location /static/ {
#         alias /usr/share/nginx/html/static/;  # Ruta donde están tus archivos estáticos
#         expires 1y;  # Cacheo para optimizar el rendimiento
#         access_log off;
#         add_header Cache-Control "public";
#     }
# }